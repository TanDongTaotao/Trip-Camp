# 成员C阶段1代码说明文档

## 项目概述

本项目是Trip-Camp项目的管理端（PC后台）部分，由成员C负责开发。管理端采用React + Ant Design技术栈，实现了登录、注册、角色管理等功能。

## 技术栈

- React 18
- Ant Design 5
- React Router 6
- Axios
- Express（后端）
- MongoDB（后端）

## 目录结构

```
Trip-Camp/
  apps/
    admin/              # 管理端项目
      src/
        assets/         # 静态资源
        components/     # 组件
        pages/          # 页面
        utils/          # 工具函数
        App.jsx         # 应用主组件
        main.jsx        # 应用入口
      package.json      # 项目依赖
  server/              # 后端项目
    src/
      routes/          # 路由
      models/          # 数据模型
      middlewares/     # 中间件
      utils/           # 工具函数
      config/          # 配置
```

## 核心文件说明

### 1. 前端工具函数

#### 1.1 登录状态管理 (utils/auth.js)

```javascript
// 登录状态管理工具

// 存储token到localStorage
export const setToken = (token) => {
  localStorage.setItem('token', token)
}

// 从localStorage获取token
export const getToken = () => {
  return localStorage.getItem('token')
}

// 从localStorage移除token
export const removeToken = () => {
  localStorage.removeItem('token')
}

// 检查是否已登录
export const isAuthenticated = () => {
  return !!getToken()
}

// 存储用户信息到localStorage
export const setUser = (user) => {
  localStorage.setItem('user', JSON.stringify(user))
}

// 从localStorage获取用户信息
export const getUser = () => {
  const userStr = localStorage.getItem('user')
  return userStr ? JSON.parse(userStr) : null
}

// 从localStorage移除用户信息
export const removeUser = () => {
  localStorage.removeItem('user')
}

// 清空所有认证信息
export const clearAuth = () => {
  removeToken()
  removeUser()
}
```

**说明**：
- 该文件提供了登录状态管理的核心功能，包括token和用户信息的存储、获取和清除
- 使用localStorage进行存储，确保刷新页面后登录状态仍然保持
- `setToken`和`setUser`用于存储token和用户信息
- `getToken`和`getUser`用于获取token和用户信息
- `removeToken`和`removeUser`用于移除token和用户信息
- `isAuthenticated`用于检查是否已登录
- `clearAuth`用于清空所有认证信息，通常在登出时调用

#### 1.2 请求封装 (utils/api.js)

```javascript
import axios from 'axios'
import { getToken, clearAuth } from './auth'

// 创建axios实例
const api = axios.create({
  baseURL: 'http://localhost:3000/api/v1', // 后端API基础路径
  timeout: 10000, // 请求超时时间
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器：自动携带token
api.interceptors.request.use(
  config => {
    const token = getToken()
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// 响应拦截器：统一处理错误
api.interceptors.response.use(
  response => {
    return response.data
  },
  error => {
    if (error.response) {
      // 服务器返回错误状态码
      const { status, data } = error.response
      if (status === 401) {
        // 未授权，需要重新登录
        console.error('未授权，请重新登录')
        // 清除token
        clearAuth()
        // 跳转到登录页
        window.location.href = '/login'
      } else {
        // 其他错误
        console.error('请求错误:', data.message || '未知错误')
      }
    } else if (error.request) {
      // 请求已发送但没有收到响应
      console.error('网络错误，请检查网络连接')
    } else {
      // 请求配置出错
      console.error('请求配置错误:', error.message)
    }
    return Promise.reject(error)
  }
)

// 导出api实例
export default api
```

**说明**：
- 该文件使用Axios创建了一个请求实例，并配置了基础路径、超时时间等
- 添加了请求拦截器，自动携带token到请求头中
- 添加了响应拦截器，统一处理错误，特别是401错误（未授权）
- 当遇到401错误时，会清除token并跳转到登录页
- 导出api实例，供其他组件使用

### 2. 前端组件

#### 2.1 路由守卫 (components/PrivateRoute.jsx)

```javascript
import { Navigate, Outlet, useEffect } from 'react-router-dom'
import { isAuthenticated, getUser } from '../utils/auth'

const PrivateRoute = () => {
  // 检查是否已登录
  const authenticated = isAuthenticated()
  
  // 如果已登录，渲染子路由；否则跳转到登录页
  return authenticated ? <Outlet /> : <Navigate to="/login" replace /> 
}

export default PrivateRoute
```

**说明**：
- 该组件是一个路由守卫，用于保护需要登录才能访问的页面
- 使用`isAuthenticated`函数检查用户是否已登录
- 如果已登录，渲染子路由（通过`<Outlet />`）
- 如果未登录，跳转到登录页

#### 2.2 登录页面 (pages/LoginPage.jsx)

```javascript
import { useState } from 'react'
import { Card, Form, Input, Button, message, Typography, Link } from 'antd'
import { LockOutlined, UserOutlined } from '@ant-design/icons'
import { useNavigate } from 'react-router-dom'
import api from '../utils/api'
import { setToken, setUser } from '../utils/auth'

const { Title } = Typography

const LoginPage = () => {
  // 加载状态
  const [loading, setLoading] = useState(false)
  // 导航实例
  const navigate = useNavigate()

  // 表单提交处理
  const handleSubmit = async (values) => {
    // 设置加载状态
    setLoading(true)
    try {
      // 调用登录接口
      const response = await api.post('/auth/login', values)
      const { token, user } = response
      
      // 存储token和用户信息
      setToken(token)
      setUser(user)
      
      // 显示成功消息
      message.success('登录成功')
      // 跳转到首页
      navigate('/')
    } catch (error) {
      // 显示错误消息
      message.error('登录失败：' + (error.response?.data?.message || error.message))
    } finally {
      // 重置加载状态
      setLoading(false)
    }
  }

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      height: '100vh',
      backgroundColor: '#f0f2f5'
    }}>
      <Card style={{ width: 400, boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)' }}>
        <div style={{ textAlign: 'center', marginBottom: 24 }}>
          <Title level={3}>Trip-Camp 管理后台登录</Title>
        </div>
        <Form
          name="login"
          initialValues={{ remember: true }}
          onFinish={handleSubmit}
        >
          {/* 用户名输入框 */}
          <Form.Item
            name="username"
            rules={[{ required: true, message: '请输入用户名！' }]}
          >
            <Input prefix={<UserOutlined />} placeholder="用户名" />
          </Form.Item>
          {/* 密码输入框 */}
          <Form.Item
            name="password"
            rules={[{ required: true, message: '请输入密码！' }]}
          >
            <Input.Password prefix={<LockOutlined />} placeholder="密码" />
          </Form.Item>
          {/* 登录按钮 */}
          <Form.Item>
            <Button 
              type="primary" 
              htmlType="submit" 
              style={{ width: '100%' }} 
              loading={loading}
            >
              登录
            </Button>
          </Form.Item>
          {/* 注册链接 */}
          <Form.Item>
            <div style={{ textAlign: 'center' }}>
              没有账号？ <Link to="/register">去注册</Link>
            </div>
          </Form.Item>
        </Form>
      </Card>
    </div>
  )
}

export default LoginPage
```

**说明**：
- 该组件是登录页面，使用Ant Design的Form组件实现登录表单
- 表单包含用户名、密码输入框和登录按钮
- 提交表单时，调用`/auth/login`接口进行登录
- 登录成功后，存储token和用户信息，并跳转到首页
- 登录失败时，显示错误消息
- 页面底部有注册链接，点击可跳转到注册页面

#### 2.3 注册页面 (pages/RegisterPage.jsx)

```javascript
import { useState } from 'react'
import { Card, Form, Input, Button, message, Typography, Select } from 'antd'
import { LockOutlined, UserOutlined, TeamOutlined } from '@ant-design/icons'
import { useNavigate, Link } from 'react-router-dom'
import api from '../utils/api'
import { setToken, setUser } from '../utils/auth'

const { Title } = Typography
const { Option } = Select

const RegisterPage = () => {
  // 加载状态
  const [loading, setLoading] = useState(false)
  // 导航实例
  const navigate = useNavigate()

  // 表单提交处理
  const handleSubmit = async (values) => {
    // 设置加载状态
    setLoading(true)
    try {
      // 调用注册接口
      const response = await api.post('/auth/register', values)
      const { token, user } = response
      
      // 存储token和用户信息
      setToken(token)
      setUser(user)
      
      // 显示成功消息
      message.success('注册成功')
      // 跳转到首页
      navigate('/')
    } catch (error) {
      // 显示错误消息
      message.error('注册失败：' + (error.response?.data?.message || error.message))
    } finally {
      // 重置加载状态
      setLoading(false)
    }
  }

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      height: '100vh',
      backgroundColor: '#f0f2f5'
    }}>
      <Card style={{ width: 400, boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)' }}>
        <div style={{ textAlign: 'center', marginBottom: 24 }}>
          <Title level={3}>Trip-Camp 管理后台注册</Title>
        </div>
        <Form
          name="register"
          initialValues={{ role: 'merchant' }}
          onFinish={handleSubmit}
        >
          {/* 用户名输入框 */}
          <Form.Item
            name="username"
            rules={[{ required: true, message: '请输入用户名！' }, { min: 3, message: '用户名至少3个字符！' }]}
          >
            <Input prefix={<UserOutlined />} placeholder="用户名" />
          </Form.Item>
          {/* 密码输入框 */}
          <Form.Item
            name="password"
            rules={[{ required: true, message: '请输入密码！' }, { min: 6, message: '密码至少6个字符！' }]}
          >
            <Input.Password prefix={<LockOutlined />} placeholder="密码" />
          </Form.Item>
          {/* 角色选择 */}
          <Form.Item
            name="role"
            rules={[{ required: true, message: '请选择角色！' }]}
          >
            <Select prefix={<TeamOutlined />} placeholder="选择角色">
              <Option value="merchant">商户</Option>
              <Option value="admin">管理员</Option>
            </Select>
          </Form.Item>
          {/* 注册按钮 */}
          <Form.Item>
            <Button 
              type="primary" 
              htmlType="submit" 
              style={{ width: '100%' }} 
              loading={loading}
            >
              注册
            </Button>
          </Form.Item>
          {/* 登录链接 */}
          <Form.Item>
            <div style={{ textAlign: 'center' }}>
              已有账号？ <Link to="/login">去登录</Link>
            </div>
          </Form.Item>
        </Form>
      </Card>
    </div>
  )
}

export default RegisterPage
```

**说明**：
- 该组件是注册页面，使用Ant Design的Form组件实现注册表单
- 表单包含用户名、密码输入框、角色选择和注册按钮
- 用户名要求至少3个字符，密码要求至少6个字符
- 角色选择支持商户和管理员两种角色
- 提交表单时，调用`/auth/register`接口进行注册
- 注册成功后，存储token和用户信息，并跳转到首页
- 注册失败时，显示错误消息
- 页面底部有登录链接，点击可跳转到登录页面

#### 2.4 后台布局 (components/AdminLayout.jsx)

```javascript
import { Outlet, useNavigate, useLocation } from 'react-router-dom'
import { Layout, Menu, Button, message } from 'antd'
import { MenuUnfoldOutlined, MenuFoldOutlined, UserOutlined, LogoutOutlined, HomeOutlined, ShopOutlined, SettingOutlined, TeamOutlined } from '@ant-design/icons'
import { useState, useEffect } from 'react'
import { clearAuth, getUser } from '../utils/auth'
import api from '../utils/api'

const { Header, Sider, Content } = Layout

const AdminLayout = () => {
  // 侧边栏折叠状态
  const [collapsed, setCollapsed] = useState(false)
  // 用户信息
  const [user, setUser] = useState(null)
  // 菜单项
  const [menuItems, setMenuItems] = useState([])
  // 导航实例
  const navigate = useNavigate()
  // 路由位置
  const location = useLocation()

  // 页面加载时获取用户信息
  useEffect(() => {
    // 从localStorage获取用户信息
    const localUser = getUser()
    if (localUser) {
      setUser(localUser)
      generateMenuItems(localUser.role)
    }
    
    // 调用/auth/me接口获取最新的用户信息
    const fetchUserInfo = async () => {
      try {
        const response = await api.get('/auth/me')
        setUser(response.user)
        generateMenuItems(response.user.role)
      } catch (error) {
        console.error('获取用户信息失败：', error)
        // 如果获取用户信息失败，可能是token过期，需要清除token并跳转到登录页
        if (error.response?.status === 401) {
          clearAuth()
          navigate('/login')
        }
      }
    }

    fetchUserInfo()
  }, [navigate])

  // 根据role生成菜单
  const generateMenuItems = (role) => {
    // 基础菜单（所有角色都可见）
    const baseItems = [
      {
        key: '/',
        icon: <HomeOutlined />,
        label: '仪表盘'
      }
    ]

    // 角色特定菜单
    let roleItems = []

    // 商户角色菜单
    if (role === 'merchant') {
      roleItems = [
        {
          key: '/merchant',
          icon: <ShopOutlined />,
          label: '商户管理'
        }
      ]
    } 
    // 管理员角色菜单
    else if (role === 'admin') {
      roleItems = [
        {
          key: '/admin',
          icon: <TeamOutlined />,
          label: '管理员管理'
        }
      ]
    }

    // 合并菜单
    const allItems = [...baseItems, ...roleItems]
    setMenuItems(allItems)
  }

  // 切换侧边栏折叠状态
  const toggleCollapse = () => {
    setCollapsed(!collapsed)
  }

  // 菜单点击处理
  const handleMenuClick = (e) => {
    navigate(e.key)
  }

  // 登出处理
  const handleLogout = () => {
    // 清除认证信息
    clearAuth()
    // 显示成功消息
    message.success('登出成功')
    // 跳转到登录页
    navigate('/login')
  }

  // 获取当前路径作为默认选中的菜单项
  const getSelectedKey = () => {
    return location.pathname
  }

  return (
    <Layout style={{ minHeight: '100vh' }}>
      {/* 侧边栏 */}
      <Sider 
        trigger={null} 
        collapsible 
        collapsed={collapsed}
        style={{ background: '#001529' }}
      >
        <div style={{ height: 32, margin: 16, background: 'rgba(255, 255, 255, 0.2)', borderRadius: 4 }} />
        {/* 菜单 */}
        <Menu
          theme="dark"
          mode="inline"
          selectedKeys={[getSelectedKey()]}
          items={menuItems}
          onClick={handleMenuClick}
        />
      </Sider>
      {/* 主内容区 */}
      <Layout>
        {/* 顶部导航 */}
        <Header style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: '#fff' }}>
          {/* 侧边栏折叠按钮 */}
          <Button
            type="text"
            icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}
            onClick={toggleCollapse}
            style={{ fontSize: '16px', width: 64, height: 64 }}
          />
          {/* 用户信息和登出按钮 */}
          <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
            <span>欢迎，{user?.username || '管理员'} (role: {user?.role || '未知'})</span>
            <Button 
              type="text" 
              icon={<LogoutOutlined />} 
              onClick={handleLogout}
            >
              登出
            </Button>
          </div>
        </Header>
        {/* 内容区域 */}
        <Content style={{ margin: 24, padding: 24, background: '#fff', minHeight: 280 }}>
          <Outlet />
        </Content>
      </Layout>
    </Layout>
  )
}

export default AdminLayout
```

**说明**：
- 该组件是后台布局组件，使用Ant Design的Layout组件实现布局
- 布局包含侧边栏、顶部导航和内容区域
- 侧边栏根据用户角色动态生成菜单：
  - 商户角色显示"仪表盘"和"商户管理"菜单
  - 管理员角色显示"仪表盘"和"管理员管理"菜单
- 顶部导航显示用户信息和登出按钮
- 内容区域通过`<Outlet />`渲染子路由
- 页面加载时，从localStorage获取用户信息，并调用`/auth/me`接口获取最新的用户信息
- 如果获取用户信息失败且状态码为401，清除token并跳转到登录页

### 3. 后端文件

#### 3.1 认证路由 (server/src/routes/auth.js)

```javascript
// 认证模块路由（Auth）：
//
// 目标：
// - 提供 "注册 / 登录 / 获取当前用户" 三个最小闭环接口
// - 统一错误输出为 { code, message, details? }，便于前端统一处理
//
// 路由（挂载路径：/api/v1/auth）：
// - POST /register：注册（role=user/merchant/admin）
//   - 注意：是否允许注册 admin 由环境变量 ALLOW_ADMIN_REGISTER 控制
// - POST /login：登录（根据 username/password 校验）
// - GET  /me：获取当前登录用户（需要 Bearer Token）
const express = require('express')
const { User } = require('../models/User')
const { AppError } = require('../utils/errors')
const { hashPassword, verifyPassword } = require('../utils/password')
const { signToken } = require('../utils/jwt')
const { requireAuth } = require('../middlewares/requireAuth')

const router = express.Router()

// 转换用户对象为公开字段
function toUserPublic(user) {
  // 对外只返回可公开字段：
  // - 避免泄露敏感信息（如 passwordHash）
  // - 同时保持响应结构稳定，便于前端做角色判断与展示
  return {
    id: String(user._id),
    username: user.username,
    role: user.role,
  }
}

// 注册接口
router.post('/register', async (req, res, next) => {
  try {
    // 1) 读取参数
    const { username, password, role } = req.body || {}

    // 2) admin 注册策略
    // 推荐策略：
    // - 生产环境：默认禁止 admin 注册（除非显式开启）
    // - 开发/作业环境：默认允许 admin 注册（便于"注册页可选角色"的验收）
    // 可通过环境变量显式覆盖：
    // - ALLOW_ADMIN_REGISTER=true  -> 强制允许
    // - ALLOW_ADMIN_REGISTER=false -> 强制禁止
    const allowAdminRegisterRaw = String(process.env.ALLOW_ADMIN_REGISTER || '').trim().toLowerCase()
    const allowAdminRegisterExplicit = allowAdminRegisterRaw.length > 0
    const allowAdminRegister =
      (allowAdminRegisterExplicit && ['true', '1', 'yes', 'y'].includes(allowAdminRegisterRaw)) ||
      (!allowAdminRegisterExplicit &&
        String(process.env.NODE_ENV || 'development').trim().toLowerCase() !== 'production')
    const allowedRoles = ['user', 'merchant', 'admin']

    // 3) 基础参数校验
    const normalizedUsername = typeof username === 'string' ? username.trim() : ''
    if (!normalizedUsername || normalizedUsername.length < 3) {
      throw new AppError({
        status: 422,
        code: 'VALIDATION_ERROR',
        message: 'Invalid username',
        details: { field: 'username' },
      })
    }
    if (!password || typeof password !== 'string' || password.length < 6) {
      throw new AppError({
        status: 422,
        code: 'VALIDATION_ERROR',
        message: 'Invalid password',
        details: { field: 'password' },
      })
    }
    if (!role || !allowedRoles.includes(role)) {
      throw new AppError({
        status: 422,
        code: 'VALIDATION_ERROR',
        message: 'Invalid role',
        details: { field: 'role' },
      })
    }
    if (role === 'admin' && !allowAdminRegister) {
      throw new AppError({
        status: 403,
        code: 'FORBIDDEN',
        message: 'Admin register disabled',
      })
    }

    // 4) 唯一性检查：username 唯一
    const existing = await User.findOne({ username: normalizedUsername }).lean()
    if (existing) {
      throw new AppError({
        status: 409,
        code: 'USERNAME_TAKEN',
        message: 'Username already exists',
      })
    }

    // 5) 写入用户
    // - 密码仅保存哈希
    // - role 用于后续权限控制
    const passwordHash = await hashPassword(password)
    const user = await User.create({
      username: normalizedUsername,
      passwordHash,
      role,
    })

    // 6) 签发 token
    // - token 内只放最小必要字段（id/role），便于鉴权与角色判断
    // - username 等展示信息由 /me 返回，避免 token 体积膨胀
    const token = signToken({ id: String(user._id), role: user.role })
    res.json({ token, user: toUserPublic(user) })
  } catch (e) {
    next(e)
  }
})

// 登录接口
router.post('/login', async (req, res, next) => {
  try {
    // 1) 读取参数
    const { username, password } = req.body || {}

    // 2) 基础校验：避免空值导致异常
    const normalizedUsername = typeof username === 'string' ? username.trim() : ''
    if (!normalizedUsername) {
      throw new AppError({
        status: 422,
        code: 'VALIDATION_ERROR',
        message: 'Invalid username',
        details: { field: 'username' },
      })
    }
    if (!password || typeof password !== 'string') {
      throw new AppError({
        status: 422,
        code: 'VALIDATION_ERROR',
        message: 'Invalid password',
        details: { field: 'password' },
      })
    }

    // 3) 查用户并校验密码
    const user = await User.findOne({ username: normalizedUsername })
    if (!user) {
      throw new AppError({
        status: 401,
        code: 'UNAUTHORIZED',
        message: 'Username or password incorrect',
      })
    }

    const ok = await verifyPassword(password, user.passwordHash)
    if (!ok) {
      throw new AppError({
        status: 401,
        code: 'UNAUTHORIZED',
        message: 'Username or password incorrect',
      })
    }

    // 4) 登录成功签发 token
    const token = signToken({ id: String(user._id), role: user.role })
    res.json({ token, user: toUserPublic(user) })
  } catch (e) {
    next(e)
  }
})

// 获取当前用户接口（需要认证）
router.get('/me', requireAuth, async (req, res, next) => {
  try {
    // requireAuth 会把 token payload 放到 req.user（至少包含 id/role）
    const userId = req.user && req.user.id
    if (!userId) {
      throw new AppError({
        status: 401,
        code: 'UNAUTHORIZED',
        message: 'Token missing or invalid',
      })
    }
    const user = await User.findById(userId)
    if (!user) {
      throw new AppError({
        status: 401,
        code: 'UNAUTHORIZED',
        message: 'Token missing or invalid',
      })
    }
    res.json({ user: toUserPublic(user) })
  } catch (e) {
    next(e)
  }
})

module.exports = { authRouter: router }
```

**说明**：
- 该文件是后端的认证路由，实现了注册、登录、获取当前用户三个接口
- **注册接口** (`POST /auth/register`)：
  - 接受用户名、密码、角色三个参数
  - 对参数进行校验，包括用户名长度、密码长度、角色有效性
  - 检查用户名是否已存在
  - 对密码进行哈希处理后存储
  - 签发JWT token并返回
- **登录接口** (`POST /auth/login`)：
  - 接受用户名、密码两个参数
  - 对参数进行校验
  - 根据用户名查找用户
  - 校验密码是否正确
  - 签发JWT token并返回
- **获取当前用户接口** (`GET /auth/me`)：
  - 需要Bearer Token认证
  - 从token中获取用户ID
  - 根据用户ID查找用户并返回

## 功能流程

### 1. 登录流程

1. 用户访问登录页面 (`/login`)
2. 输入用户名和密码
3. 点击登录按钮，调用`/auth/login`接口
4. 登录成功后，存储token和用户信息到localStorage
5. 跳转到首页 (`/`)
6. 首页显示用户信息和对应角色的菜单

### 2. 注册流程

1. 用户访问注册页面 (`/register`)
2. 输入用户名、密码，选择角色
3. 点击注册按钮，调用`/auth/register`接口
4. 注册成功后，存储token和用户信息到localStorage
5. 跳转到首页 (`/`)
6. 首页显示用户信息和对应角色的菜单

### 3. 角色权限控制

1. 登录或注册成功后，获取用户角色
2. 根据用户角色生成不同的菜单：
   - 商户角色：显示"仪表盘"和"商户管理"菜单
   - 管理员角色：显示"仪表盘"和"管理员管理"菜单
3. 后台布局根据用户角色动态调整菜单显示

## 安全措施

1. **密码安全**：密码采用bcrypt算法进行哈希处理后存储，不存储明文密码
2. **认证安全**：使用JWT token进行身份认证，token有效期为7天
3. **权限控制**：根据用户角色控制菜单和页面访问权限
4. **错误处理**：统一错误处理，避免敏感信息泄露
5. **请求拦截**：前端请求自动携带token，后端验证token有效性

## 常见问题与解决方案

1. **问题**：登录后刷新页面，用户信息丢失
   **解决方案**：使用localStorage存储token和用户信息，页面加载时从localStorage获取

2. **问题**：token过期后，页面没有反应
   **解决方案**：在响应拦截器中处理401错误，清除token并跳转到登录页

3. **问题**：不同角色看到相同的菜单
   **解决方案**：在AdminLayout组件中根据用户角色动态生成菜单

4. **问题**：注册时无法选择管理员角色
   **解决方案**：检查环境变量`ALLOW_ADMIN_REGISTER`是否设置为true

## 总结

本项目实现了管理端（PC后台）的登录、注册、角色管理等功能，采用React + Ant Design技术栈，结合Express + MongoDB后端，构建了一个完整的认证系统。系统支持商户和管理员两种角色，根据角色控制菜单显示，实现了基本的权限管理。

项目代码结构清晰，功能完整，安全性高，为后续的功能扩展奠定了基础。