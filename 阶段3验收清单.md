# 阶段 3 验收清单（Trip-Camp｜最终阶段）

说明：

- 本清单用于验收 **阶段 3（商户录入/编辑/提交审核 + 管理员审核/发布/下线 + 用户端联动可见）** 的最终交付结果。
- 后端 Base URL：`http://localhost:3000`
- API 前缀：`/api/v1`
- 鉴权：`Authorization: Bearer <token>`
- 角色：`user` / `merchant` / `admin`
- 错误结构：`{ code, message, details? }`

---

## 0. 启动检查

- [x] 后端 `server/` 可启动，且 `GET http://localhost:3000/health` 返回 `{ ok: true }`
- [ ] 移动端 `apps/mobile/` 可启动并打开页面（H5 或小程序其一即可）
- [ ] 管理端 `apps/admin/` 可启动并打开页面（merchant/admin 均可登录）

---

## 1. 后端（A）阶段3：商户 / 管理员接口验收（Apifox 或 curl 均可）

### 1.1 商户接口（merchant）

- [x] `POST /api/v1/merchant/hotels`：新建酒店成功，默认 `auditStatus=draft` 且 `onlineStatus=offline`
- [x] `PUT /api/v1/merchant/hotels/:id`：编辑酒店成功（含房型/价格），返回结构稳定
- [x] `POST /api/v1/merchant/hotels/:id/submit`：状态从 `draft/rejected` 变为 `pending`
- [x] `GET /api/v1/merchant/hotels`：仅返回当前 merchant 自己的酒店（不可越权），支持分页

越权用例：

- [x] merchant A 修改/提交 merchant B 的酒店：返回 `403`（或你们约定的错误码）

### 1.2 管理员接口（admin）

- [x] `GET /api/v1/admin/hotels`：支持按 `auditStatus/onlineStatus` 筛选 + 分页
- [x] `POST /api/v1/admin/hotels/:id/audit`：
  - [x] approve：`pending` → `approved`
  - [x] reject：`pending` → `rejected` 且必须保存 `rejectReason`
- [x] `POST /api/v1/admin/hotels/:id/publish`：`approved + offline` → `online`
- [x] `POST /api/v1/admin/hotels/:id/offline`：`online` → `offline`，且可再次 `publish` 恢复上线
- [x] （可选加分）`DELETE /api/v1/admin/hotels/:id`：软删除（写入 `deletedAt`），用户端不可见

### 1.3 用户端可见性联动（必须）

- [x] 用户端 `GET /api/v1/hotels` 仅返回 `auditStatus=approved` 且 `onlineStatus=online` 且未删除的酒店
- [x] 管理员下线后：用户端列表立刻不可见；详情返回 `404`（或你们约定的“不可见”错误结构）
- [x] 重新发布后：用户端可再次搜到并打开详情

---

## 2. 管理端（C）阶段3：商户端（merchant）页面验收

- [ ] 登录 merchant 后，仅展示商户菜单与页面（路由不可越权）
- [ ] 酒店录入/编辑页：必做维度齐全并校验（缺字段有明确提示）
  - [ ] 酒店名（中/英）、地址、星级、房型、价格、开业时间
- [ ] 房型管理：可新增/删除/修改房型，价格校验合理（≥ 0）
- [ ] 商户酒店列表：展示 `auditStatus/onlineStatus`，支持编辑与提交审核
- [ ] 被拒绝酒店：能看到 `rejectReason`，修改后可再次提交审核

---

## 3. 管理端（C）阶段3：管理员端（admin）页面验收

- [ ] 登录 admin 后，仅展示管理员菜单与页面（路由不可越权）
- [ ] 审核列表：可筛选 `pending/approved/rejected` + `online/offline`，分页可用
- [ ] 审核拒绝：必须填写原因；列表/详情能展示原因
- [ ] 发布上线：仅允许 `approved` 酒店发布；发布后用户端可见
- [ ] 下线：下线后用户端不可见；可恢复上线（再次发布）

---

## 4. 移动端（B）阶段3：体验与性能验收（最终阶段）

- [ ] 列表页上拉加载稳定（不重复请求、不乱序），loading/empty/error 状态完整
- [ ] 详情页房型按价格从低到高展示（与商户录入价格一致）
- [ ] 交互优化：按钮防连点、请求失败提示友好、返回后条件保留（至少做到 1–2 个亮点）
- [ ] 长列表性能：至少有“明显措施”（节流/分页渲染/虚拟列表其一）并能说明收益

---

## 5. 最终交付物（答辩/评分）

- [ ] 录屏：merchant 新建/编辑酒店 → 提交审核 → admin 审核通过 → 发布上线
- [ ] 录屏：用户端搜索到该酒店 → 进入详情 → 展示房型与价格排序
- [ ] 录屏：admin 下线酒店 → 用户端立刻消失；再发布 → 用户端恢复
