# 阶段 1 验收清单（Trip-Camp）

目标：在阶段 0 已跑通的基础上，完成商户/管理员登录态闭环，并能在管理端基于角色做展示/控制。

统一约定：

- Base URL：`http://localhost:3000/api/v1`
- 认证方式：`Authorization: Bearer <token>`
- 角色：`merchant` / `admin`
- 错误结构：`{ code, message, details? }`

---

## 0. 环境与启动（验收前置）

### 后端（server）

- [x] `npm run dev` 可启动服务，控制台输出监听端口（默认 3000）
- [x] `GET http://localhost:3000/health` 返回 `200 { ok: true }`
- [x] 未携带 token 时：`GET /auth/me` 返回 `401` 且 `code=UNAUTHORIZED`

### 移动端（apps/mobile）

- [x] `npm run dev:h5` 可启动并能打开 H5 页面（默认 `http://localhost:10086/`）

### 管理端（apps/admin）

- [x] 在阶段 0 基础上可启动并能打开页面（仅验证“阶段 1 增量功能”，不重复验收阶段 0 初始化项）

---

## 1. Auth 接口验收（Apifox 或 curl 均可）

### 1.1 注册（POST /auth/register）

对每个角色分别完成一次注册并保存返回的 token：

- [x] 注册 merchant：请求体包含 `role=merchant`，响应包含 `token`，且 `user.role=merchant`
- [x] 注册 admin：请求体包含 `role=admin`，响应包含 `token`，且 `user.role=admin`

错误用例（任选其一截图即可）：

- [x] 用户名重复：返回 `409` 且 `code=USERNAME_TAKEN`
- [x] 参数不合法：返回 `422` 且 `code=VALIDATION_ERROR`（例如 password 太短或 role 非法）

### 1.2 登录（POST /auth/login）

对每个角色分别完成一次登录并保存返回的 token：

- [x] 登录 merchant：响应包含 `token`，且 `user.role=merchant`
- [x] 登录 admin：响应包含 `token`，且 `user.role=admin`

错误用例：

- [x] 用户名或密码错误：返回 `401` 且 `code=UNAUTHORIZED`

### 1.3 获取当前用户（GET /auth/me）

分别用两种 token 调用：

- [x] merchant token：返回 `200` 且 `user.role=merchant`
- [x] admin token：返回 `200` 且 `user.role=admin`

错误用例：

- [x] 不带 token 或 token 无效：返回 `401` 且 `code=UNAUTHORIZED`

---

## 2. 管理端（C）阶段 1 验收点（在阶段 0 基础上的新增）

### 3.1 登录/注册页

- [x] 注册页支持选择角色进行注册（至少 merchant/admin）
- [x] 登录页不需要选择角色，调用 `POST /auth/login` 获取 token
- [x] token 持久化（localStorage/sessionStorage 任一）并能在刷新后保持登录态或可重新拉取 me

### 3.2 请求封装与登录态

- [x] baseUrl 统一为 `http://localhost:3000/api/v1`
- [x] 请求自动携带 `Authorization: Bearer <token>`
- [x] `GET /auth/me` 能获取到 `role` 并在页面显式展示（例如 Header 里显示 `role: admin`）
- [x] 401 统一处理：清空 token 并跳转登录页

### 3.3 基础布局与路由占位

- [x] 后台基础布局完成（侧边栏 + 顶部 + 内容区）
- [x] 路由占位页至少包含：
  - [x] 商户端占位页（例如“酒店信息录入/编辑”入口）
  - [x] 管理员占位页（例如“审核/发布/下线列表”入口）
- [x] 菜单/路由基于 `role` 做最小控制：
  - [x] merchant 登录后只显示商户菜单入口
  - [x] admin 登录后只显示管理员菜单入口

验收截图建议：

- [ ] 登录后页面展示 role，并且侧边栏菜单随 role 变化的对比截图（merchant vs admin）

---

## 3. 交付物（用于答辩/评分）

- [ ] 两角色在 Apifox 的 register/login/me 成功截图（包含 role）
- [ ] 管理端登录后展示 role + 菜单随角色变化截图
