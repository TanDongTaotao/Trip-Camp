# 阶段 1 验收清单（Trip-Camp）

目标：在阶段 0 已跑通的基础上，完成三角色登录态闭环，并能在管理端基于角色做展示/控制。

统一约定：
- Base URL：`http://localhost:3000/api/v1`
- 认证方式：`Authorization: Bearer <token>`
- 角色：`user` / `merchant` / `admin`
- 错误结构：`{ code, message, details? }`

---

## 0. 环境与启动（验收前置）

### 后端（server）
- [ ] `npm run dev` 可启动服务，控制台输出监听端口（默认 3000）
- [ ] `GET http://localhost:3000/health` 返回 `200 { ok: true }`
- [ ] 未携带 token 时：`GET /auth/me` 返回 `401` 且 `code=UNAUTHORIZED`

### 移动端（apps/mobile）
- [ ] `npm run dev:h5` 可启动并能打开 H5 页面（默认 `http://localhost:10086/`）
- [ ] 能从首页进入 Login 页面并完成登录跳转回首页

### 管理端（apps/admin）
- [ ] 在阶段 0 基础上可启动并能打开页面（仅验证“阶段 1 增量功能”，不重复验收阶段 0 初始化项）

---

## 1. Auth 接口验收（Apifox 或 curl 均可）

### 1.1 注册（POST /auth/register）

对每个角色分别完成一次注册并保存返回的 token：
- [ ] 注册 user：请求体包含 `role=user`，响应包含 `token`，且 `user.role=user`
- [ ] 注册 merchant：请求体包含 `role=merchant`，响应包含 `token`，且 `user.role=merchant`
- [ ] 注册 admin：请求体包含 `role=admin`，响应包含 `token`，且 `user.role=admin`

错误用例（任选其一截图即可）：
- [ ] 用户名重复：返回 `409` 且 `code=USERNAME_TAKEN`
- [ ] 参数不合法：返回 `422` 且 `code=VALIDATION_ERROR`（例如 password 太短或 role 非法）

### 1.2 登录（POST /auth/login）

对每个角色分别完成一次登录并保存返回的 token：
- [ ] 登录 user：响应包含 `token`，且 `user.role=user`
- [ ] 登录 merchant：响应包含 `token`，且 `user.role=merchant`
- [ ] 登录 admin：响应包含 `token`，且 `user.role=admin`

错误用例：
- [ ] 用户名或密码错误：返回 `401` 且 `code=UNAUTHORIZED`

### 1.3 获取当前用户（GET /auth/me）

分别用三种 token 调用：
- [ ] user token：返回 `200` 且 `user.role=user`
- [ ] merchant token：返回 `200` 且 `user.role=merchant`
- [ ] admin token：返回 `200` 且 `user.role=admin`

错误用例：
- [ ] 不带 token 或 token 无效：返回 `401` 且 `code=UNAUTHORIZED`

---

## 2. 移动端（B）阶段 1 验收点

说明：移动端阶段 1 只验收“用户侧登录态可用”，为后续阶段 2 接酒店接口做准备。

- [ ] Login 页调用 `POST /auth/login` 成功后将 token 写入本地存储（storage）
- [ ] Home 页调用 `GET /auth/me`：
  - [ ] 已登录：能展示/Toast 出用户名或 role（任一即可）
  - [ ] 未登录/过期：跳转到 Login
- [ ] 请求封装自动携带 `Authorization`，且非 2xx 能提示错误并抛出（避免静默失败）

验收截图建议：
- [ ] 登录成功后 token 写入与 `/auth/me` 返回 user 的截图（或页面展示）

---

## 3. 管理端（C）阶段 1 验收点（在阶段 0 基础上的新增）

### 3.1 登录/注册页
- [ ] 注册页支持选择角色进行注册（至少 merchant/admin）
- [ ] 登录页不需要选择角色，调用 `POST /auth/login` 获取 token
- [ ] token 持久化（localStorage/sessionStorage 任一）并能在刷新后保持登录态或可重新拉取 me

### 3.2 请求封装与登录态
- [ ] baseUrl 统一为 `http://localhost:3000/api/v1`
- [ ] 请求自动携带 `Authorization: Bearer <token>`
- [ ] `GET /auth/me` 能获取到 `role` 并在页面显式展示（例如 Header 里显示 `role: admin`）
- [ ] 401 统一处理：清空 token 并跳转登录页

### 3.3 基础布局与路由占位
- [ ] 后台基础布局完成（侧边栏 + 顶部 + 内容区）
- [ ] 路由占位页至少包含：
  - [ ] 商户端占位页（例如“酒店信息录入/编辑”入口）
  - [ ] 管理员占位页（例如“审核/发布/下线列表”入口）
- [ ] 菜单/路由基于 `role` 做最小控制：
  - [ ] merchant 登录后只显示商户菜单入口
  - [ ] admin 登录后只显示管理员菜单入口

验收截图建议：
- [ ] 登录后页面展示 role，并且侧边栏菜单随 role 变化的对比截图（merchant vs admin）

---

## 4. 交付物（用于答辩/评分）

- [ ] 三角色在 Apifox 的 register/login/me 成功截图（包含 role）
- [ ] 管理端登录后展示 role + 菜单随角色变化截图
- [ ] 移动端登录态验证截图（Home 调 /me 成功或未登录跳转）

