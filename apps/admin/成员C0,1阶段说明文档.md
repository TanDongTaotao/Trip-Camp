# 成员C 0/1 阶段说明文档（管理端 apps/admin）

## 1. 项目定位与阶段目标

本目录是 **Trip-Camp 管理端（PC 后台）** 前端工程，负责为商户（merchant）与管理员（admin）提供登录后的后台基础框架与后续业务入口。

- 阶段 0 目标：把 React + AntD 项目跑起来，搭好后台基础布局与最小登录态，能完成登录并在前端拿到 role。
- 阶段 1 目标：补齐登录/注册闭环与 token 持久化，打通 `/auth/me` 并基于 role 做菜单/页面占位控制。

## 2. 技术栈

- React 18：组件与状态管理（Hook）
- Vite 5：本地开发与构建
- Ant Design 5：后台 UI 组件库
- React Router 6：路由与受保护路由（登录守卫）
- Axios：请求封装（统一 baseUrl + 拦截器）

## 3. 后端接口约定（来自 server）

管理端不实现任何后端接口逻辑，所有接口均来自仓库根目录的 [server](file:///f:/PycharmProjects/Trip-Camp/server)。

- API BaseUrl：`http://localhost:3000/api/v1`
- 登录：`POST /auth/login`
  - 请求：`{ username, password }`
  - 响应：`{ token, user }`
- 注册：`POST /auth/register`
  - 请求：`{ username, password, role }`（管理端阶段 1 主要用 `merchant/admin`）
  - 响应：`{ token, user }`
- 获取当前用户：`GET /auth/me`
  - 请求头：`Authorization: Bearer <token>`
  - 响应：`{ user }`（包含 `user.role`）

统一异常处理策略：

- 401：认为 token 失效/未登录，清空本地 token 与 user，并跳转到 `/login`。

## 4. 本地运行

1) 启动后端（根目录下的 server）：

```bash
cd server
npm install
npm run dev
```

1) 启动管理端（本目录 apps/admin）：

```bash
cd apps/admin
npm install
npm run dev
```

默认开发地址：`http://localhost:5173/`

## 5. 阶段 0 实现说明

- 初始化 React + AntD 工程并可运行（Vite）
- 后台基础布局（侧边栏 + 顶部 + 内容区）
- 登录页最小实现：
  - 调用 `POST /auth/login` 获取 token
  - token 写入 localStorage（刷新后仍可读取）
- 请求封装最小实现：
  - 统一 baseUrl
  - 自动携带 `Authorization`
- `/auth/me` 打通并在前端展示 role（Dashboard / Header 展示）

## 6. 阶段 1 增量实现说明

- 注册页：支持选择角色注册（至少 `merchant/admin`），调用 `POST /auth/register`
- 登录页：不选择角色，调用 `POST /auth/login`
- token 持久化：token 与 user 写入 localStorage，刷新后可恢复登录态
- 401 统一处理：拦截器清理本地登录态并跳转登录页
- 基于 role 的最小控制：
  - 菜单仅展示当前角色的入口
  - 手动输入 URL 越权访问时重定向到允许访问的页面

## 7. 目录结构与文件职责（按链路理解）

```text
apps/admin/
  index.html
  package.json
  vite.config.js
  .eslintrc.cjs
  src/
    main.jsx
    App.jsx
    App.css
    index.css
    components/
      AdminLayout.jsx
      PrivateRoute.jsx
    pages/
      LoginPage.jsx
      RegisterPage.jsx
      Dashboard.jsx
      MerchantPage.jsx
      AdminPage.jsx
    utils/
      api.js
      auth.js
```

- `package.json`：依赖与脚本（dev/build/lint）
- `index.html`：应用挂载点（`#root`）与入口脚本（`/src/main.jsx`）
- `vite.config.js`：Vite 最小构建配置（React 插件）
- `.eslintrc.cjs`：ESLint 配置，保证 `npm run lint` 可用

**入口与路由**

- `src/main.jsx`：React 根节点挂载与渲染 App
- `src/App.jsx`：路由总表（公开页 / 受保护页 / 布局容器）
- `src/index.css`：全局基础样式（reset + body 背景/字体）
- `src/App.css`：Layout 相关样式（Sider/Header/Content 的基础外观）

**登录态与请求**

- `src/utils/auth.js`：localStorage 登录态存取（token/user）与清理
- `src/utils/api.js`：Axios 实例（baseURL + token 注入 + 401 统一跳登录）

**布局与权限**

- `src/components/AdminLayout.jsx`：
  - 布局骨架（Sider/Header/Content）
  - 首屏从 localStorage 取 user，随后 `/auth/me` 校准
  - 根据 `user.role` 生成菜单
  - 根据 `user.role` 对路由做最小越权重定向
- `src/components/PrivateRoute.jsx`：路由守卫（本地无 token 则跳 `/login`）

**页面**

- `src/pages/LoginPage.jsx`：登录表单 -> `POST /auth/login` -> 写 token/user -> 跳首页
- `src/pages/RegisterPage.jsx`：注册表单 -> `POST /auth/register`（含 role）-> 写 token/user -> 跳首页
- `src/pages/Dashboard.jsx`：首页；调用 `GET /auth/me` 并展示 user 信息（重点：role）
- `src/pages/MerchantPage.jsx`：商户占位页（后续接酒店录入/编辑/提交审核）
- `src/pages/AdminPage.jsx`：管理员占位页（后续接酒店审核/发布/下线）

## 8. 验收对照（阶段 1）

对应根目录 [阶段1验收清单.md](file:///f:/PycharmProjects/Trip-Camp/%E9%98%B6%E6%AE%B51%E9%AA%8C%E6%94%B6%E6%B8%85%E5%8D%95.md) 的「管理端（C）阶段 1 验收点」：

- 注册页可选角色注册（merchant/admin）
- 登录页登录成功后能持久化 token
- `/auth/me` 可获取 role 并在页面展示（Header / Dashboard）
- 401 统一清 token 并跳登录页
- 布局与路由占位齐全（仪表盘 + 商户页 + 管理员页）
- 菜单/路由基于 role 最小控制
