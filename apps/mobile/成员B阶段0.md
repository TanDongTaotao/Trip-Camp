# 成员B阶段0（Mobile / Taro）说明文档

本文档用于说明成员 B 在阶段 0 的移动端（H5 优先）交付内容：已完成的任务、代码结构与文件职责、技术栈与版本信息、以及与后端联调的接口约定。

## 1. 阶段0已完成任务（对照清单）

- 初始化 Taro 项目并跑通 H5 预览（阶段 0 优先 H5，不要求小程序端）
- 搭页面壳 + 路由（首页/列表/详情），并额外提供登录页用于联调
- 完成“登录态最小实现”
  - 登录页调用 `POST /auth/login` 获取 token
  - token 写入 storage
  - Home 页调用 `GET /auth/me` 验证登录态（无 token 会跳转登录页）
- 完成统一请求封装
  - 默认 `baseUrl = http://localhost:3000/api/v1`
  - 自动携带 `Authorization: Bearer <token>`
  - 非 2xx 状态码统一 Toast + 抛错

## 2. 技术栈与版本说明

技术栈：
- 框架：Taro（React 语法）
- 运行端：H5（Webpack5 runner）
- 语言：JavaScript（未启用 TypeScript）

关键版本（来自 `apps/mobile/package.json`）：
- `@tarojs/*`: `4.1.11`
- `react`: `^18.0.0`
- `react-dom`: `^18.0.0`
- `webpack`: `^5.75.0`

备注：
- 若遇到 Windows 下 Taro 创建用户目录缓存时报 `EPERM`，可用“自定义 USERPROFILE/HOME”的方式启动（见第 5 节）。

## 3. 项目结构与文件说明

目录：
- `config/`
  - `index.js`：Taro 构建总配置（包含 H5 devServer proxy）
  - `dev.js` / `prod.js`：按环境合并配置
- `src/`
  - `app.js`：应用入口组件（挂载全局样式与页面容器）
  - `app.config.js`：页面路由表与全局窗口配置
  - `pages/`：页面（阶段 0 为壳与联调最小链路）
  - `utils/request.js`：请求封装（自动带 token，统一错误处理）

页面（`src/app.config.js`）：
- `pages/home/index`
  - 阶段 0：提供“Check Login”按钮验证登录态
- `pages/login/index`
  - 阶段 0：账号密码登录，成功后保存 token 并跳转 Home
- `pages/list/index`
  - 阶段 0：占位页（后续对接酒店列表 `GET /hotels`）
- `pages/detail/index`
  - 阶段 0：占位页（读取 `id` 参数，后续对接酒店详情 `GET /hotels/:id`）

## 4. 与后端的对接说明（阶段0）

后端基础信息：
- Base URL：`http://localhost:3000/api/v1`
- 健康检查：`GET http://localhost:3000/health` → `{ ok: true }`

请求封装约定（`src/utils/request.js`）：
- 请求头：
  - 默认 `Content-Type: application/json`
  - 若 storage 中存在 token，会自动追加：
    - `Authorization: Bearer <token>`
- 错误处理：
  - 非 2xx：Toast 展示 `message`，并抛出 Error（`error.statusCode`、`error.data` 可用）

阶段 0 具体接口：
- `POST /auth/login`
  - 请求 body：`{ "username": "...", "password": "..." }`
  - 响应：`{ "token": "...", "user": { "id": "...", "username": "...", "role": "..." } }`
- `GET /auth/me`
  - 需要请求头 `Authorization: Bearer <token>`
  - 响应：`{ "user": { "id": "...", "username": "...", "role": "..." } }`
  - 无 token/无效 token：返回 401

## 5. 启动与验证方式（H5）

前置条件：
- `server/` 后端已启动并监听 `http://localhost:3000`

在 `apps/mobile` 目录执行：

```bash
npm install
npm run dev:h5
```

H5 访问地址（默认）：
- `http://localhost:10086/`

Windows 权限问题（可选）：
- 若启动时出现 `.taro4.0` 相关 `EPERM`（无法创建用户目录缓存），可用下列方式启动（在 `apps/mobile` 目录）：

```powershell
$env:USERPROFILE="$pwd\.userprofile"; $env:HOME=$env:USERPROFILE; npm run dev:h5
```

阶段 0 最短联调闭环：
1) 打开 H5：`http://localhost:10086/`
2) 进入 Login 页，输入账号密码点击 Login
3) 登录成功后回 Home，点击 “Check Login”
4) 看到 `Hello <username>` 的 Toast 即表示登录态链路成功

