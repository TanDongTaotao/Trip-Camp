# 角色分工与阶段任务划分（按作业要求）

本文件用于把“用户 / 商户 / 管理员”三个角色在不同阶段要做的功能拆清楚，方便排期、对齐接口、答辩时讲清楚闭环。

约定：
- Base URL：`/api/v1`
- 鉴权：`Authorization: Bearer <token>`
- 角色：`user` / `merchant` / `admin`
- 酒店状态机（后续阶段会用到）：
  - `auditStatus`：`draft` → `pending` → `approved` / `rejected`
  - `onlineStatus`：`offline` ↔ `online`

---

## 阶段 0：项目准备（所有角色共用）

目标：让所有人都能“跑起来 + 能联调 + 能截图证明”。

后端（成员 A）：
- 本地启动服务，确认 `/health` 返回 `{ ok: true }`
- 提供 Apifox 导入与环境配置说明（Base URL、Token 用法）
- 确认 Auth 三接口稳定可用：`register/login/me`
- 统一错误返回结构：`{ code, message, details? }`

前端（成员 B/C）：
- Apifox 能调通：注册 → 登录 → me
- 把 token 存储策略确定下来（Taro：storage；Web：localStorage/sessionStorage）

---

## 阶段 1：登录态跑通（作业必做：管理系统登录/注册）

目标：三种角色都能注册/登录，前端能拿到 role 并做页面/菜单控制。

### user（普通用户）

需要实现的页面/能力：
- 仅用于“用户端预定流程”的登录态基础能力（如果你们用户端不做登录，也至少要能在 Apifox 里注册 user）

接口清单：
- `POST /auth/register`（role=user）
- `POST /auth/login`
- `GET /auth/me`

验收截图建议：
- register/login/me 的响应（包含 token 与 user.role=user）

### merchant（商户）

需要实现的页面/能力（PC 管理端）：
- 登录页/注册页
- 登录后可进入“酒店信息录入/编辑/修改”页面（下一阶段做功能）

接口清单：
- `POST /auth/register`（role=merchant）
- `POST /auth/login`
- `GET /auth/me`

验收截图建议：
- 登录后调用 me 返回 role=merchant，菜单展示“商户端功能”

### admin（管理员）

需要实现的页面/能力（PC 管理端）：
- 登录页/注册页（作业要求“注册界面可选择角色”，因此需要能注册 admin）
- 登录后可进入“审核/发布/下线列表”页面（下一阶段做功能）

接口清单：
- `POST /auth/register`（role=admin）
- `POST /auth/login`
- `GET /auth/me`

验收截图建议：
- 登录后调用 me 返回 role=admin，菜单展示“管理员功能”

---

## 阶段 2：用户端可见（作业必做：酒店查询/列表/详情）

目标：用户端完整走通“查询 → 列表 → 详情”的浏览链路；数据来自后端接口，前后端能联调。

### user（普通用户｜移动端预定流程）

页面任务（对齐作业说明）：
- 酒店查询页（首页）
  - Banner：点击跳详情
  - 查询条件：城市/定位、关键词、入住离店日期、筛选（星级/价格）、快捷标签
  - 点击查询跳列表页
- 酒店列表页
  - 顶部核心条件条（城市、日期、搜索）
  - 详细筛选区域（可自定义）
  - 酒店列表：支持上滑加载（分页）
- 酒店详情页
  - 顶部导航 + 大图轮播
  - 基础信息（酒店名/星级/设施/地址）
  - 日期选择与房型列表（房型按价格从低到高）

接口清单（用户端用）：
- `GET /hotels`
  - 查询参数建议：`city`、`keyword`、`checkIn`、`checkOut`、`tags`、`page`、`pageSize`、`sort`
- `GET /hotels/:id`

后端数据规则（用户端可见性）：
- 仅返回：`auditStatus=approved` 且 `onlineStatus=online` 且未删除 的酒店

验收截图建议：
- 首页查询条件 + 点击查询
- 列表页分页加载（至少两页）
- 详情页轮播 + 房型按价格排序

### merchant / admin（此阶段可不做业务操作）

此阶段主要是给用户端做“可见数据”。
- 商户/管理员端可先只保留入口页面与占位 UI（不扣必做）

---

## 阶段 3：商户录入 + 管理员审核/发布（作业必做：录入/编辑/审核/发布/下线）

目标：跑通“商户创建酒店 → 提交审核 → 管理员审核（通过/拒绝）→ 发布上线 → 下线可恢复”的完整闭环。

### merchant（商户｜PC 管理端）

页面任务：
- 酒店信息录入/编辑/修改页面
  - 表单：对齐必做维度（酒店名中/英、地址、星级、房型、价格、开业时间）
  - 图片：先用 URL 输入框（加分项再做上传）
  - 保存后列表实时更新
- 商户酒店列表页（只看自己的酒店）
  - 状态展示：auditStatus/onlineStatus
  - 操作：编辑、提交审核

接口清单（商户端用）：
- `POST /merchant/hotels`（新建，默认 `draft`）
- `PUT /merchant/hotels/:id`（编辑，仅草稿/被拒绝时允许编辑更合理）
- `POST /merchant/hotels/:id/submit`（提交审核：`draft/rejected` → `pending`）
- `GET /merchant/hotels`（查询商户自己的酒店）

验收截图建议：
- 新建酒店成功（看到 draft）
- 提交审核后变为 pending

### admin（管理员｜PC 管理端）

页面任务：
- 酒店信息审核/发布/下线列表页面
  - 列表筛选：auditStatus、onlineStatus
  - 审核动作：通过 / 拒绝（拒绝必须填原因）
  - 发布上线：approved + offline → online
  - 下线：online → offline（注意不是删除）
  - 可恢复：offline → online（如果你们设计为“恢复发布”按钮）

接口清单（管理员端用）：
- `GET /admin/hotels`（按状态筛选）
- `POST /admin/hotels/:id/audit`（approve/reject + rejectReason）
- `POST /admin/hotels/:id/publish`
- `POST /admin/hotels/:id/offline`
- `DELETE /admin/hotels/:id`（软删除加分项，可选）

验收截图建议：
- 审核通过：pending → approved
- 审核拒绝：pending → rejected（能看到 rejectReason）
- 发布上线：offline → online
- 下线与恢复：online → offline → online

### user（普通用户｜与阶段 2 联动验收）

联动验收要点：
- 用户端列表只出现“approved + online”的酒店
- 管理员下线后，用户端列表立即消失（再次发布后恢复出现）

验收截图建议：
- 管理端发布/下线前后，用户端列表对比

---

## 推荐排期（最不容易卡的顺序）

1) 阶段 1：Auth（前后端联调先通）
2) 阶段 2：先做 `GET /hotels` / `GET /hotels/:id`（用户端页面可先用假数据再切真数据）
3) 阶段 3：商户写入 → 管理员审核 → 上线 → 用户端可见（闭环答辩最加分）

